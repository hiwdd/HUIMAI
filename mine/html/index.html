<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../css/public.css">
    <link rel="stylesheet" type="text/css" href="../css/index.css">
    <script src="../js/jquery.js"></script>
</head>

<body>
    <!-- 菜单 -->
    <div id="menu">
        <div class="core clearfix">
            <div id="notify" class="fl">
                <a href="#"><img src="../img/notify.jpg" /></a>公告：
                <p>紧急通知紧急通知</p>
            </div>
            <ul id="menu_list" class="fr">
                <li id="reg_tag"><a href="./register.html">注册</a></li>
                <li id="login_tag"><a href="./login.html">登录</a></li>
                <li><a href="#">我的订单</a></li>
                <li><a href="#">我的关注</a></li>
                <li><a href="#">资讯</a></li>
                <li><a href="#">品牌库</a></li>
                <li><a href="#"><img src="../img/phone.jpg" /><span>手机惠买</span></a></li>
            </ul>
        </div>
    </div>
    <!-- logo-搜索-二维码 -->
    <div id="headbar">
        <div class="core flx">
            <div id="weblogo"><a href="#"><img src="../img/logo.jpg" /></a></div>

            <div class="search">
                <input type="text" placeholder="请输入商品名称或货号">
                <button>搜索</button>
            </div>
            
            <div id="qrcode">
                <a href="#"><p class="fl">下载APP&nbsp;&nbsp;<br/>立即拼团享实惠</p><img src="../img/qr.jpg" /></a>
            </div>
        </div>
    </div>
    <!-- 商品导航 -->
    <div id="nav">
        <div class="core">
            <ul class="nav nav-pills">
                <li role="presentation"><a href="#">首页</a></li>
                <li role="presentation"><a href="#">视频</a></li>
                <li role="presentation"><a href="#">品质厨房</a></li>
                <li role="presentation"><a href="#">美食民生</a></li>
                <li role="presentation"><a href="#">健康生活</a></li>
                <li role="presentation"><a href="#">魅力穿戴</a></li>
                <li role="presentation"><a href="#">珠宝收藏</a></li>
                <li role="presentation"><a href="#">美肤靓装</a></li>
                <li role="presentation" id="classify"><a href="#"><img src="../img/sub_nav_lf.jpg" /><span>在线分类</span><img src="../img/sub_nav_rt.jpg" /></a></li>
            </ul>
        </div>
    </div>

    <div id="banner">
        <ul class="bannerUl clearfix">
            <li><a href="#"><img src="../img/banner1.jpg" alt="惠买"></a></li>
            <li style="display:none;"><a href="#"><img src="../img/banner2.jpg" alt="惠买"></a></li>
        </ul>
    </div>
    <div id="content">
        <div class="container">
            <ul class="tv">
                <li class="fl"><i><img src="../img/red.gif" alt="惠买"></i><strong><b>TV</b>直播</strong>上惠买APP，拼着买更便宜
                </li>
                <li class="fr"><a><img src="../img/jmb.jpg" alt="惠买"></a></li>
            </ul>
            <div class="zhibo">
                <a href="#">
                    <img src="../img/pic1.jpg" alt="惠买">
                    <p>美国西屋营养萃取破壁机</p>
                    <p><em>￥599</em><i>￥699</i></p>
                </a>
                <a href="#">
                    <img src="../img/pic1.jpg" alt="惠买">
                    <p>美国西屋营养萃取破壁机</p>
                    <p><em>￥599</em><i>￥699</i></p>
                </a>
                <a href="#">
                    <img src="../img/pic1.jpg" alt="惠买">
                    <p>美国西屋营养萃取破壁机</p>
                    <p><em>￥599</em><i>￥699</i></p>
                </a>
            </div>
            <h3 class="jr"><img src="../img/red.gif" alt="惠买"><em>今日</em>必抢</h3>
            <div class="biqiang">
                <div class="bi-left fl">
                    <a href="#"><img src="../img/biqiang.jpg" alt="惠买"></a>
                </div>
                <div class="bi-right fr">
                    <a href="#">
                        <img src="../img/pic2.jpg" alt="惠买">
                        <p>
                            洲泉100%优质双宫茧箐松皓月桑蚕长丝被200*230cm·500g·强韧长丝！夏季好被！国标优等！ 玫瑰红
                        </p>
                        <p><em>￥359</em><i>￥699</i></p>
                        <div class="now">马上抢</div>
                    </a>
                    <a href="#">
                        <img src="../img/pic2.jpg" alt="惠买">
                        <p>
                            洲泉100%优质双宫茧箐松皓月桑蚕长丝被200*230cm·500g·强韧长丝！夏季好被！国标优等！ 玫瑰红
                        </p>
                        <p><em>￥359</em><i>￥699</i></p>
                        <div class="now">马上抢</div>
                    </a>
                    <a href="#">
                        <img src="../img/pic2.jpg" alt="惠买">
                        <p>
                            洲泉100%优质双宫茧箐松皓月桑蚕长丝被200*230cm·500g·强韧长丝！夏季好被！国标优等！ 玫瑰红
                        </p>
                        <p><em>￥359</em><i>￥699</i></p>
                        <div class="now">马上抢</div>
                    </a>
                </div>
            </div>

            
            <!-- 瀑布流 -->
            <h3 class="huixuanBar"><span>惠买优选</span></h3>
            <div id="publiu">
                <ul>
                    <li>
                    </li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                    <li></li>
                </ul>
            </div>
        </div>
    </div>

</body>

</html>

<script>

//瀑布流
var ul = document.getElementById("publiu").firstElementChild;
var list = ul.getElementsByTagName("li"); 

//默认加载
loadImg();
function loadImg(){
    $.getJSON("./hmyx.json",function(data){
        for(var i=0; i < list.length; i++){
            if(data[i]){
                // console.log(data[i]);
                //pic
                var img = document.createElement("img");
                img.src = data[i].src;
                list[i].appendChild(img);

                //info
                list[i].appendChild( add_info(data[i]) );
                
            }else{
                var p = document.createElement("p");
                p.innerText = "no more to see";
                list[i].appendChild(p);
            }
        }
    });
}

document.onscroll = function (){
    var ch = document.documentElement.clientHeight;
    var sh = document.documentElement.scrollTop;
    //获取窗口滚走距离scrolltop
    //是否大于document.body.scrollHeight
    if(sh + ch >= document.body.scrollHeight){
        $.getJSON("./hmyx.json",function(data){
            // console.log(list.length);
            if(data.length <= list.length){
                alert("no more goods");
                return;
            }else{
                for(var i=list.length; i < data.length; i++){
                    if(data[i]){
                        var newli = document.createElement("li");
                        var img = document.createElement("img");
                        img.src = data[i].src;
                        newli.appendChild(img);

                        newli.appendChild( add_info(data[i]) );
                        ul.appendChild(newli);

                    }else{
                        alert("no more goods");
                        return;
                    }
                }
            }
            
        });
    }
}


function add_info(arr){
    var div = document.createElement("div");
    div.className = "info";
    // list[i].appendChild(div);
    var h4 = document.createElement("h4");
    h4.innerHTML = arr.content;
    // console.log(data[i].content);
    div.appendChild(h4);

    var sub_div = document.createElement("div");
    sub_div.className = "sub_info";

    var span1 = document.createElement("span");
    span1.className = "price_tag";
    // console.log(data[i].price);
    span1.innerHTML = "￥" + arr.price;

    sub_div.appendChild(span1);

    var span2 = document.createElement("span");
    span2.className = "numb";
    var str = `<b>${arr.num}</b>人已购买`;
    span2.innerHTML = str;

    sub_div.appendChild(span2);
    div.appendChild(sub_div);
    // list[i].appendChild(div);

    return div;
}


//商品点击跳转详情页面---委托
$(".zhibo a").on("click",function(){
    // console.log(this);
    var param = $(this).children("img")[0].src;
    // console.log(param);
    location.href = "./xq.php?imgsrc="+param;
});

$(".biqiang a").on("click",function(){
    // console.log(this);
    var param = $(this).children("img")[0].src;
    // console.log(param);
    location.href = "./xq.php?imgsrc="+param;
});

$("#publiu ul").on("click","li",function(){
    // console.log(this);
    var param = $(this).children("img")[0].src;
    // console.log(param);
    location.href = "./xq.php?imgsrc="+param;
});
</script>